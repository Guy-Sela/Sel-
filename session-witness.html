<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Session Witness</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400&family=Josefin+Sans:wght@300;400&display=swap"
    rel="stylesheet">
  <style>
    .hud-font {
      font-family: 'JetBrains Mono', monospace;
    }

    /* Scanlines - matching library's scanlineIntensity: 0.6 */
    .scanline {
      background: repeating-linear-gradient(0deg,
          transparent,
          transparent 1px,
          rgba(0, 0, 0, 0.15) 1px,
          rgba(0, 0, 0, 0.15) 2px);
      pointer-events: none;
    }

    /* Retrace lines - animated scanlines moving upward (library: retraceLines) */
    @keyframes retrace {
      0% {
        background-position: 0 0;
      }

      100% {
        background-position: 0 -4px;
      }
    }

    .crt-retrace {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: repeating-linear-gradient(0deg,
          transparent,
          transparent 1px,
          rgba(255, 255, 255, 0.02) 1px,
          rgba(255, 255, 255, 0.02) 2px);
      pointer-events: none;
      z-index: 10;
      animation: retrace 0.1s linear infinite;
    }

    /* Rolling refresh bar - sweeps bottom to top */
    @keyframes crt-roll {
      0% {
        top: 100%;
      }

      100% {
        top: -8%;
      }
    }

    .crt-rollbar::before {
      content: '';
      position: absolute;
      left: 0;
      right: 0;
      height: 8%;
      background: linear-gradient(to bottom,
          transparent 0%,
          rgba(255, 255, 255, 0.015) 40%,
          rgba(255, 255, 255, 0.03) 50%,
          rgba(255, 255, 255, 0.015) 60%,
          transparent 100%);
      pointer-events: none;
      z-index: 11;
      animation: crt-roll 6s linear infinite;
    }

    @keyframes blink {

      0%,
      50% {
        opacity: 1;
      }

      51%,
      100% {
        opacity: 0;
      }
    }

    .blink {
      animation: blink 1s infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 0.5;
      }

      50% {
        opacity: 0.8;
      }
    }

    .pulse {
      animation: pulse 3s ease-in-out infinite;
    }


    /* Chromatic Aberration - library: chromaticAberration: 0.0005 (subtle RGB split) */
    .crt-text {
      text-shadow:
        -0.3px 0 0 rgba(255, 0, 0, 0.25),
        0.3px 0 0 rgba(0, 255, 255, 0.25),
        0 0 1px rgba(255, 255, 255, 0.15);
    }

    /* Flicker - library: flicker: 0.01, brightness: 0.9 */
    @keyframes crt-flicker {

      0%,
      100% {
        opacity: 0.97;
      }

      5% {
        opacity: 0.98;
      }

      10% {
        opacity: 0.96;
      }

      15% {
        opacity: 0.99;
      }

      20% {
        opacity: 0.95;
      }

      50% {
        opacity: 0.98;
      }

      80% {
        opacity: 0.96;
      }

      95% {
        opacity: 0.99;
      }
    }

    .crt-flicker {
      animation: crt-flicker 0.15s infinite;
    }

    /* Signal loss bands - library: signalLoss: 0.05 */
    @keyframes signal-loss {
      0% {
        transform: translateY(0);
      }

      100% {
        transform: translateY(-100%);
      }
    }

    .crt-signal::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 200%;
      background: repeating-linear-gradient(0deg,
          transparent 0px,
          transparent 40px,
          rgba(0, 0, 0, 0.03) 40px,
          rgba(0, 0, 0, 0.03) 42px,
          transparent 42px,
          transparent 80px);
      pointer-events: none;
      z-index: 9;
      animation: signal-loss 4s linear infinite;
    }

    /* Static noise - library: staticNoise: 0.001 */
    @keyframes noise {

      0%,
      100% {
        background-position: 0 0;
      }

      10% {
        background-position: -5% -10%;
      }

      20% {
        background-position: -15% 5%;
      }

      30% {
        background-position: 7% -25%;
      }

      40% {
        background-position: -5% 25%;
      }

      50% {
        background-position: -15% 10%;
      }

      60% {
        background-position: 15% 0%;
      }

      70% {
        background-position: 0% 15%;
      }

      80% {
        background-position: 3% 35%;
      }

      90% {
        background-position: -10% 10%;
      }
    }

    .crt-noise::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      right: -50%;
      bottom: -50%;
      width: 200%;
      height: 200%;
      pointer-events: none;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
      opacity: 0.015;
      z-index: 8;
      animation: noise 0.08s steps(8) infinite;
    }

    /* Desaturation + contrast - library: desaturation: 0.2, contrast: 1.0, brightness: 0.9 */
    .crt-color {
      filter: saturate(0.8) contrast(1.05) brightness(0.92);
    }

    /* Hero HUD - same layout for mobile and desktop */
    #heroHud {
      display: flex;
      /* Fluid font: 11px → 14px (readable for dense data displays) */
      font-size: clamp(0.6875rem, 0.6rem + 0.35vw, 0.875rem);
      line-height: 1.6;
      /* Always start from the top (override Tailwind's justify-center) */
      justify-content: flex-start;
      align-items: center;
      /* Always fit fully in the viewport (mobile-safe height units) */
      height: 100vh;
      height: 100svh;
      min-height: 100vh;
      min-height: 100svh;
      /* Nice, consistent padding across screens */
      padding: clamp(1rem, 3vh, 2.5rem) clamp(1rem, 4vw, 2.5rem);
    }

    #heroHud .hud-container {
      width: 100%;
      /* Fluid max-width: scales with viewport */
      max-width: clamp(20rem, 85vw, 60rem);
      transform-origin: top center;
      will-change: transform;
    }

    /* Responsive grid: 1 col mobile → 2 col tablet → 3 col desktop */
    #heroHud .hud-grid {
      display: grid;
      /* Always at least 2 columns, even on narrow screens */
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.75rem 1.5rem;
    }

    /* In 2-col mode, LIVE sits on its own row and should span both columns
       so it can use the "empty" space to the right. */
    #heroHud .hud-live {
      grid-column: 1 / -1;
    }

    @media (min-width: 640px) {
      #heroHud .hud-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (min-width: 1024px) {
      #heroHud .hud-grid {
        grid-template-columns: repeat(3, 1fr);
      }

      /* On desktop 3-col layout, LIVE returns to being a normal column */
      #heroHud .hud-live {
        grid-column: auto;
      }
    }

    /* LIVE: use space wisely by flowing into 2 sub-columns when there's room */
    #heroHud .live-grid {
      display: grid;
      /* Default: exactly 2 columns on mobile/tablet (including <360px) */
      grid-template-columns: repeat(2, minmax(0, 1fr));
      column-gap: 1.25rem;
      row-gap: 0;
    }

    /* Desktop: keep LIVE as a single column list */
    @media (min-width: 1024px) {
      #heroHud .live-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Section labels: ~85% of base, uppercase tracking */
    .hud-label {
      font-size: 0.85em;
      letter-spacing: 0.05em;
    }

    /* Hide desktop HUD completely - using unified hero */
    #desktopHud {
      display: none !important;
    }

    /* Sticky nav behavior */
    #stickyNav {
      transform: translateY(-100%);
      transition: transform 0.3s ease;
    }

    #stickyNav.visible {
      transform: translateY(0);
    }

    /* Works should not appear before the header "menu" appears */
    #works {
      opacity: 0;
      transform: translateY(16px);
      transition: opacity 0.3s ease, transform 0.3s ease;
      transition-delay: 0.06s;
      /* slight sync with header slide-in */
    }

    #works.works-visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* Sticky header nav styling */
    #stickyNav .brand {
      letter-spacing: 0.12em;
    }

    #stickyNav .nav-link {
      color: rgba(255, 255, 255, 0.78);
      border-bottom: 1px solid transparent;
      padding-bottom: 0.15rem;
      transition: color 160ms ease, border-color 160ms ease;
    }

    #stickyNav .nav-link:hover {
      color: rgba(255, 255, 255, 0.95);
    }

    #stickyNav .nav-link.active {
      color: rgba(255, 255, 255, 1);
      border-color: rgba(255, 255, 255, 0.55);
    }

    /* Reveal text - fades on scroll */
    #revealText.hidden {
      opacity: 0;
    }

    /* Reveal text typography (use ID so it always applies, even if Tailwind JIT misses arbitrary values) */
    #revealText {
      line-height: 2.2;
    }

    @media (min-width: 768px) {
      #revealText {
        line-height: 2.3;
      }
    }

    /* Cross-dissolve container (tall) + stage (sticky) */
    #dissolve-container {
      position: relative;
      height: 300vh;
      /* 100vh fade + 100vh hold + then continue */
    }

    #dissolve-stage {
      position: sticky;
      top: 0;
      height: 100vh;
    }

    /* Hero and Reveal are stacked inside the sticky stage.
       IMPORTANT: We fade wrapper layers (not #heroHud directly) because #heroHud
       has a CRT flicker animation that also animates `opacity` and would override JS. */
    #dissolve-stage #heroLayer,
    #dissolve-stage #revealLayer {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 100vh;
    }

    #dissolve-stage #heroLayer {
      z-index: 20;
      pointer-events: none;
      /* Allow scroll through */
      will-change: opacity;
    }

    #dissolve-stage #heroLayer * {
      pointer-events: auto;
      /* But allow interaction with HUD contents */
    }

    #dissolve-stage #revealLayer {
      z-index: 19;
      opacity: 0;
      pointer-events: none;
      will-change: opacity;
    }

    #dissolve-stage #revealLayer.active {
      pointer-events: auto;
    }

    /* Smooth scroll */
    html {
      scroll-behavior: smooth;
    }

    ::selection {
      background: rgba(100, 100, 100, 0.3);
      color: inherit;
    }

    /* ==========================================
       Works Gallery (ported from portfolio-draft)
       ========================================== */
    .clock-modal {
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .clock-modal.active {
      opacity: 1;
      visibility: visible;
    }

    .carousel-dot.active {
      background: white;
    }

    #carouselTrack {
      transition: transform 0.5s ease-out;
    }
    /* ==========================================
       TEMP: Disable CRT/HUD animations (starlight)
       Remove `disable-crt` from <body> to re-enable.
       ========================================== */
    body.disable-crt .crt-flicker,
    body.disable-crt .crt-retrace,
    body.disable-crt .scanline,
    body.disable-crt .pulse,
    body.disable-crt .crt-rollbar::before,
    body.disable-crt .crt-signal::after,
    body.disable-crt .crt-noise::before {
      animation: none !important;
    }

  </style>
</head>

<body class="bg-neutral-950 text-neutral-200 font-['Josefin_Sans'] disable-crt">
  <!-- Dissolve container wraps hero + reveal for scroll-driven cross-fade -->
  <div id="dissolve-container">
    <div id="dissolve-stage">

      <!-- ============================================== -->
      <!-- MOBILE: Full-screen Hero HUD (above the fold) -->
      <!-- ============================================== -->
      <!-- Hero with CRT effects (self-contained) -->
      <div id="heroLayer">
        <section id="heroHud"
          class="min-h-screen flex-col justify-center items-center px-4 sm:px-6 md:px-8 py-8 hud-font text-white/90 uppercase leading-relaxed relative crt-text bg-neutral-950 crt-noise crt-rollbar crt-signal crt-flicker crt-color overflow-hidden">
          <div class="crt-retrace"></div>
          <div class="scanline absolute inset-0 flicker"></div>

          <div class="hud-container relative mx-auto">
            <!-- Header -->
            <div class="flex items-center gap-2 mb-4 sm:mb-6">
              <span class="w-1.5 h-1.5 rounded-full bg-neutral-500 blink"></span>
              <span class="tracking-widest hud-label">SESSION</span>
              <span class="hud-label" id="m_sessionId">—</span>
            </div>

            <!-- Responsive grid: 1 col → 2 col → 3 col -->
            <div class="hud-grid">

              <!-- Column 1: System -->
              <div class="flicker-zone mb-6 lg:mb-0">
                <div class="hud-label tracking-wider mb-2 text-white/70">SYSTEM</div>
                <div>SCREEN: <span id="m_screen">—</span></div>
                <div>PIXEL_RATIO: <span id="m_pixelRatio">—</span></div>
                <div>COLOR_DEPTH: <span id="m_colorDepth">—</span></div>
                <div>MAX_TOUCH: <span id="m_maxTouch">—</span></div>
                <div>CPU_CORES: <span id="m_cpuCores">—</span></div>
                <div>MEMORY: <span id="m_deviceMemory">—</span></div>
                <div>PLATFORM: <span id="m_platform">—</span></div>
                <div>LANGUAGE: <span id="m_language">—</span></div>
                <div>TIMEZONE: <span id="m_timezone">—</span></div>
                <div>THEME_PREF: <span id="m_themePref">—</span></div>
                <div>REDUCE_MOTION: <span id="m_reduceMotion">—</span></div>
                <div>HISTORY_LEN: <span id="m_historyLen">—</span></div>
                <div>STORAGE_USED: <span id="m_storageUsed">—</span></div>
                <div>STORAGE_QUOTA: <span id="m_storageQuota">—</span></div>
                <div>REFERRER: <span id="m_referrer">—</span></div>
              </div>

              <!-- Column 2: Load -->
              <div class="flicker-zone mb-6 lg:mb-0">
                <div class="hud-label tracking-wider mb-2 text-white/70">LOAD</div>
                <div>PAGE_LOAD: <span id="m_pageLoad">—</span></div>
                <div>DOM_READY: <span id="m_domReady">—</span></div>
                <div>RTT: <span id="m_rtt">—</span></div>
                <div>FIRST_PAINT: <span id="m_firstPaint">—</span></div>
                <div>FCP: <span id="m_fcp">—</span></div>
                <div>LCP: <span id="m_lcp">—</span></div>
                <div>CLS: <span id="m_cls">—</span></div>
                <div>LONG_TASKS: <span id="m_longTasks">0</span></div>
                <div>JS_HEAP: <span id="m_jsHeap">—</span></div>
              </div>

              <!-- Column 3: Live Telemetry -->
              <div class="flicker-zone hud-live">
                <div class="hud-label tracking-wider mb-2 text-white/70">LIVE</div>
                <div class="live-grid">
                  <div>SESSION: <span id="m_sessionTime">00:00:00</span></div>
                  <div>LOCAL_TIME: <span id="m_localTime">—</span></div>
                  <div>TTFS: <span id="m_ttfs">—</span></div>
                  <div>TTFI: <span id="m_ttfi">—</span></div>
                  <div>IDLE: <span id="m_idleTime">0S</span></div>
                  <div>POINTER: <span id="m_pointerPos">—, —</span></div>
                  <div>VELOCITY: <span id="m_pointerVelocity">0</span></div>
                  <div>LAST_KEY: <span id="m_lastKey">—</span></div>
                  <div>CLICKS: <span id="m_clicks">0</span></div>
                  <div>LAST_CLICK: <span id="m_lastClickTime">—</span></div>
                  <div>KEYS: <span id="m_keysPressed">0</span></div>
                  <div>TOUCHES: <span id="m_touches">0</span></div>
                  <div>CLIPBOARD: <span id="m_clipboardEvents">0</span></div>
                  <div>SELECTIONS: <span id="m_selections">0</span></div>
                  <div>SCROLL_Y: <span id="m_scrollY">0</span></div>
                  <div>SCROLL_%: <span id="m_scrollDepth">0%</span></div>
                  <div>SCROLL_DIR: <span id="m_scrollDir">—</span></div>
                  <div>VIEWPORT: <span id="m_viewport">—</span></div>
                  <div>ORIENT: <span id="m_orientation">—</span></div>
                  <div>FULLSCREEN: <span id="m_fullscreen">NO</span></div>
                  <div>TAB_FOCUS: <span id="m_tabFocus">—</span></div>
                  <div>VISIBLE: <span id="m_visibility">—</span></div>
                  <div>PAGE_STATE: <span id="m_pageState">ACTIVE</span></div>
                  <div>ONLINE: <span id="m_online">—</span></div>
                  <div>CONNECTION: <span id="m_connection">—</span></div>
                  <div>NET_REQ: <span id="m_netRequests">0</span></div>
                  <div>FPS: <span id="m_frameRate">—</span></div>
                  <div>DOM_MUTATIONS: <span id="m_domMutations">0</span></div>
                  <div>ELEMENTS_SEEN: <span id="m_elementsSeen">0</span></div>
                  <div>RESIZE_EVENTS: <span id="m_resizeEvents">0</span></div>
                  <div>LAST_SELECTION: <span id="m_lastSelection">—</span></div>
                </div>
              </div>

            </div>
          </div>

        </section>
      </div>

      <!-- ============================================== -->
      <!-- DESKTOP: Floating HUD overlay (same as before) -->
      <!-- ============================================== -->
      <div id="desktopHud"
        class="hud-font fixed top-0 left-0 z-50 text-[10px] md:text-xs leading-tight uppercase text-white/90 max-h-screen overflow-y-auto hidden md:block crt-text">
        <div class="scanline absolute inset-0 flicker"></div>

        <div class="relative px-6 py-2 md:px-8 md:py-3">
          <div class="flex items-center gap-2 mb-3">
            <span class="w-1.5 h-1.5 rounded-full bg-neutral-500 blink"></span>
            <span class="tracking-widest text-[9px]">ACTIVE SESSION</span>
            <span class="text-[9px]" id="d_sessionId">—</span>
          </div>

          <div class="mb-3 pb-2 border-b border-neutral-700">
            <div class="text-[9px] tracking-wider mb-2">SYSTEM PROFILE</div>
            <div class="flex flex-col gap-0 flicker-zone">
              <div>SCREEN: <span id="d_screen">—</span></div>
              <div>PIXEL_RATIO: <span id="d_pixelRatio">—</span></div>
              <div>COLOR_DEPTH: <span id="d_colorDepth">—</span></div>
              <div>MAX_TOUCH: <span id="d_maxTouch">—</span></div>
              <div>CPU_CORES: <span id="d_cpuCores">—</span></div>
              <div>MEMORY: <span id="d_deviceMemory">—</span></div>
              <div>PLATFORM: <span id="d_platform">—</span></div>
              <div>LANGUAGE: <span id="d_language">—</span></div>
              <div>TIMEZONE: <span id="d_timezone">—</span></div>
              <div>THEME_PREF: <span id="d_themePref">—</span></div>
              <div>REDUCE_MOTION: <span id="d_reduceMotion">—</span></div>
              <div>HISTORY_LEN: <span id="d_historyLen">—</span></div>
              <div>STORAGE_USED: <span id="d_storageUsed">—</span></div>
              <div>STORAGE_QUOTA: <span id="d_storageQuota">—</span></div>
              <div>REFERRER: <span id="d_referrer">—</span></div>
            </div>
          </div>

          <div class="mb-3 pb-2 border-b border-neutral-700">
            <div class="text-[9px] tracking-wider mb-2">LOAD METRICS</div>
            <div class="flex flex-col gap-0 flicker-zone">
              <div>PAGE_LOAD: <span id="d_pageLoad">—</span></div>
              <div>DOM_READY: <span id="d_domReady">—</span></div>
              <div>RTT: <span id="d_rtt">—</span></div>
              <div>FIRST_PAINT: <span id="d_firstPaint">—</span></div>
              <div>FCP: <span id="d_fcp">—</span></div>
              <div>LCP: <span id="d_lcp">—</span></div>
              <div>CLS: <span id="d_cls">—</span></div>
              <div>LONG_TASKS: <span id="d_longTasks">0</span></div>
              <div>JS_HEAP: <span id="d_jsHeap">—</span></div>
            </div>
          </div>

          <div>
            <div class="text-[9px] tracking-wider mb-2">LIVE TELEMETRY</div>
            <div class="flex flex-col gap-0 flicker-zone">
              <div>SESSION: <span id="d_sessionTime">00:00:00</span></div>
              <div>LOCAL_TIME: <span id="d_localTime">—</span></div>
              <div>TTFS: <span id="d_ttfs">—</span></div>
              <div>TTFI: <span id="d_ttfi">—</span></div>
              <div>IDLE: <span id="d_idleTime">0S</span></div>
              <div>POINTER: <span id="d_pointerPos">—, —</span></div>
              <div>VELOCITY: <span id="d_pointerVelocity">0</span></div>
              <div>LAST_KEY: <span id="d_lastKey">—</span></div>
              <div>CLICKS: <span id="d_clicks">0</span></div>
              <div>LAST_CLICK: <span id="d_lastClickTime">—</span></div>
              <div>KEYS: <span id="d_keysPressed">0</span></div>
              <div>TOUCHES: <span id="d_touches">0</span></div>
              <div>CLIPBOARD: <span id="d_clipboardEvents">0</span></div>
              <div>SELECTIONS: <span id="d_selections">0</span></div>
              <div>SCROLL_Y: <span id="d_scrollY">0</span></div>
              <div>SCROLL_%: <span id="d_scrollDepth">0%</span></div>
              <div>SCROLL_DIR: <span id="d_scrollDir">—</span></div>
              <div>VIEWPORT: <span id="d_viewport">—</span></div>
              <div>ORIENT: <span id="d_orientation">—</span></div>
              <div>FULLSCREEN: <span id="d_fullscreen">NO</span></div>
              <div>TAB_FOCUS: <span id="d_tabFocus">—</span></div>
              <div>VISIBLE: <span id="d_visibility">—</span></div>
              <div>PAGE_STATE: <span id="d_pageState">ACTIVE</span></div>
              <div>ONLINE: <span id="d_online">—</span></div>
              <div>CONNECTION: <span id="d_connection">—</span></div>
              <div>NET_REQ: <span id="d_netRequests">0</span></div>
              <div>FPS: <span id="d_frameRate">—</span></div>
              <div>DOM_MUTATIONS: <span id="d_domMutations">0</span></div>
              <div>ELEMENTS_SEEN: <span id="d_elementsSeen">0</span></div>
              <div>RESIZE_EVENTS: <span id="d_resizeEvents">0</span></div>
              <div>LAST_SELECTION: <span id="d_lastSelection">—</span></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Desktop HUD Toggle (hidden - using unified hero layout) -->
      <button id="hudToggle" class="hidden">
        [HIDE]
      </button>

      <!-- ============================================== -->
      <!-- THE REVEAL: Philosophical message (no CRT effects) -->
      <!-- ============================================== -->
      <!-- Reveal section - cross-dissolves from hero -->
      <div id="revealLayer">
        <section id="reveal"
          class="h-full w-full flex flex-col items-center justify-center px-6 text-center bg-neutral-950">
          <p id="revealText"
            class="text-neutral-300 text-2xl md:text-3xl lg:text-4xl tracking-wide max-w-2xl transition-opacity duration-300">
            Every session is completely unique, even from the machine's perspective. FWIW.
          </p>
        </section>
      </div>

    </div><!-- end dissolve-stage -->
  </div><!-- end dissolve-container -->

  <!-- ============================================== -->
  <!-- STICKY NAV: Appears after menu, hides on scroll up -->
  <!-- ============================================== -->
  <nav id="stickyNav"
    class="fixed top-0 left-0 right-0 z-40 bg-neutral-950/90 backdrop-blur-sm border-b border-neutral-800">
    <div class="max-w-6xl mx-auto flex items-center justify-between px-5 sm:px-10 py-4">
      <a href="#works" class="brand text-white/90 uppercase tracking-widest font-semibold">SELÀ</a>
      <div class="flex items-center gap-6 sm:gap-8">
        <a href="#works" class="nav-link text-sm uppercase tracking-wider transition-colors" data-nav="works">Works</a>
        <a href="#about" class="nav-link text-sm uppercase tracking-wider transition-colors" data-nav="about">About</a>
        <a href="#contact" class="nav-link text-sm uppercase tracking-wider transition-colors"
          data-nav="contact">Contact</a>
      </div>
    </div>
  </nav>

  <!-- ============================================== -->
  <!-- MAIN CONTENT SECTIONS -->
  <!-- ============================================== -->

  <section id="works" class="pt-24 bg-neutral-950">
    <!-- 01: Conceptual Timing (carousel + modal) -->
    <article class="min-h-screen flex flex-col justify-center py-24">
      <div class="px-6 max-w-4xl mx-auto w-full mb-12">
        <span class="text-neutral-600 text-sm tracking-widest uppercase mb-4 block">01</span>
        <h2 class="text-3xl md:text-4xl lg:text-5xl font-light mb-4 text-white">Conceptual Timing</h2>
        <p class="text-neutral-400 text-lg md:text-xl font-light leading-relaxed max-w-2xl">
          A collection of meditative clocks. Each piece reimagines our relationship with time.
        </p>
      </div>

      <div class="relative w-full overflow-hidden">
        <button id="carouselPrev"
          class="hidden md:flex absolute left-4 top-1/2 -translate-y-1/2 z-10 w-12 h-12 items-center justify-center text-neutral-500 hover:text-white transition-colors"
          aria-label="Previous">
          <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M15 19l-7-7 7-7" />
          </svg>
        </button>
        <button id="carouselNext"
          class="hidden md:flex absolute right-4 top-1/2 -translate-y-1/2 z-10 w-12 h-12 items-center justify-center text-neutral-500 hover:text-white transition-colors"
          aria-label="Next">
          <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 5l7 7-7 7" />
          </svg>
        </button>

        <div id="carouselTrack" class="flex">
          <div class="carousel-item flex-shrink-0 min-w-full flex justify-center px-6 group cursor-pointer"
            onclick="openClock('semi-linear')">
            <div class="w-full max-w-md md:max-w-xl lg:max-w-2xl">
              <div class="h-64 md:h-96 lg:h-[28rem] w-full bg-neutral-900 overflow-hidden mb-4 relative">
                <iframe src="meditativeclocks/clocks/semi-linear_clock/index.html"
                  class="w-full h-full pointer-events-none" title="Semi-linear Clock preview"></iframe>
              </div>
              <h3 class="text-xl text-white text-center flex items-center justify-center gap-2">
                Semi-linear Clock
                <svg class="w-4 h-4 text-neutral-500 group-hover:text-white transition-colors" fill="none"
                  stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                    d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
                </svg>
              </h3>
            </div>
          </div>

          <div class="carousel-item flex-shrink-0 min-w-full flex justify-center px-6 group cursor-pointer"
            onclick="openClock('ebb-flow')">
            <div class="w-full max-w-md md:max-w-xl lg:max-w-2xl">
              <div class="h-64 md:h-96 lg:h-[28rem] w-full bg-neutral-900 overflow-hidden mb-4 relative">
                <iframe src="meditativeclocks/clocks/the_ebb_and_flow_of_time/index.html"
                  class="w-full h-full pointer-events-none" title="The Ebb and Flow of Time preview"></iframe>
              </div>
              <h3 class="text-xl text-white text-center flex items-center justify-center gap-2">
                The Ebb and Flow of Time
                <svg class="w-4 h-4 text-neutral-500 group-hover:text-white transition-colors" fill="none"
                  stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                    d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
                </svg>
              </h3>
            </div>
          </div>

          <div class="carousel-item flex-shrink-0 min-w-full flex justify-center px-6 group cursor-pointer"
            onclick="openClock('past-present-future')">
            <div class="w-full max-w-md md:max-w-xl lg:max-w-2xl">
              <div class="h-64 md:h-96 lg:h-[28rem] w-full bg-neutral-900 overflow-hidden mb-4 relative">
                <iframe src="meditativeclocks/clocks/present_past_and_future/index.html"
                  class="w-full h-full pointer-events-none" title="Present, Past and Future preview"></iframe>
              </div>
              <h3 class="text-xl text-white text-center flex items-center justify-center gap-2">
                Present, Past and Future
                <svg class="w-4 h-4 text-neutral-500 group-hover:text-white transition-colors" fill="none"
                  stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                    d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
                </svg>
              </h3>
            </div>
          </div>

          <div class="carousel-item flex-shrink-0 min-w-full flex justify-center px-6 group cursor-pointer"
            onclick="openClock('hourglass')">
            <div class="w-full max-w-md md:max-w-xl lg:max-w-2xl">
              <div class="h-64 md:h-96 lg:h-[28rem] w-full bg-neutral-900 overflow-hidden mb-4 relative">
                <iframe src="meditativeclocks/clocks/abstract_hourglass/index.html"
                  class="w-full h-full pointer-events-none" title="Abstract Hourglass preview"></iframe>
              </div>
              <h3 class="text-xl text-white text-center flex items-center justify-center gap-2">
                Abstract Hourglass
                <svg class="w-4 h-4 text-neutral-500 group-hover:text-white transition-colors" fill="none"
                  stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                    d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
                </svg>
              </h3>
            </div>
          </div>

          <div class="carousel-item flex-shrink-0 min-w-full flex justify-center px-6 group cursor-pointer"
            onclick="openClock('universe')">
            <div class="w-full max-w-md md:max-w-xl lg:max-w-2xl">
              <div class="h-64 md:h-96 lg:h-[28rem] w-full bg-neutral-900 overflow-hidden mb-4 relative">
                <iframe src="meditativeclocks/clocks/universe_clock/index.html"
                  class="w-full h-full pointer-events-none" title="Universe Clock preview"></iframe>
              </div>
              <h3 class="text-xl text-white text-center flex items-center justify-center gap-2">
                Universe Clock
                <svg class="w-4 h-4 text-neutral-500 group-hover:text-white transition-colors" fill="none"
                  stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                    d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
                </svg>
              </h3>
            </div>
          </div>

          <div class="carousel-item flex-shrink-0 min-w-full flex justify-center px-6 group cursor-pointer"
            onclick="openClock('serendipity')">
            <div class="w-full max-w-md md:max-w-xl lg:max-w-2xl">
              <div class="h-64 md:h-96 lg:h-[28rem] w-full bg-neutral-900 overflow-hidden mb-4 relative">
                <iframe src="meditativeclocks/clocks/serendipity/index.html"
                  class="w-full h-full pointer-events-none" title="Serendipity on Demand preview"></iframe>
              </div>
              <h3 class="text-xl text-white text-center flex items-center justify-center gap-2">
                Serendipity on Demand
                <svg class="w-4 h-4 text-neutral-500 group-hover:text-white transition-colors" fill="none"
                  stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                    d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
                </svg>
              </h3>
            </div>
          </div>
        </div>

        <div id="carouselDots" class="flex justify-center gap-2 mt-8">
          <button class="carousel-dot w-2 h-2 rounded-full bg-neutral-700 transition-colors" data-index="0"
            aria-label="Go to slide 1"></button>
          <button class="carousel-dot w-2 h-2 rounded-full bg-neutral-700 transition-colors" data-index="1"
            aria-label="Go to slide 2"></button>
          <button class="carousel-dot w-2 h-2 rounded-full bg-neutral-700 transition-colors" data-index="2"
            aria-label="Go to slide 3"></button>
          <button class="carousel-dot w-2 h-2 rounded-full bg-neutral-700 transition-colors" data-index="3"
            aria-label="Go to slide 4"></button>
          <button class="carousel-dot w-2 h-2 rounded-full bg-neutral-700 transition-colors" data-index="4"
            aria-label="Go to slide 5"></button>
          <button class="carousel-dot w-2 h-2 rounded-full bg-neutral-700 transition-colors" data-index="5"
            aria-label="Go to slide 6"></button>
        </div>
      </div>
    </article>

    <!-- 02: Pixelated Soul (text-only) -->
    <article class="min-h-screen flex flex-col justify-center px-6 py-24">
      <div class="max-w-4xl mx-auto w-full">
        <span class="text-neutral-600 text-sm tracking-widest uppercase mb-4 block">02</span>
        <h2 class="text-3xl md:text-4xl lg:text-5xl font-light mb-8 text-white">Pixelated Soul</h2>
        <p class="text-neutral-400 text-lg md:text-xl font-light leading-relaxed mb-6 max-w-3xl">
          Diary of an AI. A daily log of digital existence, documenting the evolution of a synthetic soul through
          weekly archives and immutable tokens.
        </p>
        <ul class="flex flex-wrap gap-4 mb-8 text-sm tracking-widest uppercase text-neutral-500">
          <li class="border border-neutral-800 px-3 py-1">Daily Entries</li>
          <li class="border border-neutral-800 px-3 py-1">Weekly Archives</li>
          <li class="border border-neutral-800 px-3 py-1">NFT Collection</li>
        </ul>
        <a href="https://pxsoul.selà.com/" target="_blank" rel="noopener"
          class="inline-flex items-center gap-2 text-white border-b border-neutral-700 pb-1 hover:border-white transition-colors">
          <span class="text-sm tracking-widest uppercase">View Project</span>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 17L17 7M17 7H7M17 7V17" />
          </svg>
        </a>
      </div>
    </article>

    <!-- 03: Microdosing on Enlightenment -->
    <article class="min-h-screen flex flex-col justify-center px-6 py-24">
      <div class="max-w-4xl mx-auto w-full">
        <span class="text-neutral-600 text-sm tracking-widest uppercase mb-4 block">03</span>
        <h2 class="text-3xl md:text-4xl lg:text-5xl font-light mb-8 text-white">Microdosing on
          Enlightenment</h2>
        <p class="text-neutral-400 text-lg md:text-xl font-light leading-relaxed mb-8 max-w-2xl">
          Small doses of clarity in a chaotic world. A mindfulness tool for the modern consciousness.
        </p>
        <span
          class="inline-block text-neutral-600 text-sm tracking-widest uppercase border border-neutral-800 px-4 py-2 rounded-sm">
          Coming Soon
        </span>
      </div>
    </article>
  </section>

  <section id="about" class="min-h-screen flex items-center justify-center px-6 py-24 bg-neutral-900">
    <div class="max-w-2xl w-full text-center">
      <p class="text-neutral-400 leading-relaxed mb-6">
        This is a placeholder for your about section. Tell your story, share your philosophy, explain what drives your
        work.
      </p>
      <p class="text-neutral-500 text-sm">
        The HUD above witnesses every moment of interaction. A meditation on the ephemerality of digital experience.
      </p>
    </div>
  </section>

  <section id="contact" class="min-h-screen flex items-center justify-center px-6 py-24 bg-neutral-950">
    <div class="max-w-md w-full text-center">
      <p class="text-neutral-400 mb-8">
        Placeholder for contact information.
      </p>
      <div class="space-y-4">
        <a href="#" class="block text-neutral-500 hover:text-neutral-200 transition-colors">email@example.com</a>
        <a href="#" class="block text-neutral-500 hover:text-neutral-200 transition-colors">@twitter</a>
        <a href="#" class="block text-neutral-500 hover:text-neutral-200 transition-colors">GitHub</a>
      </div>
    </div>
  </section>

  <footer class="text-center text-neutral-500 text-sm py-12 border-t border-neutral-800 bg-neutral-950">
    © <span id="year"></span> Selà
  </footer>

  <!-- Clock Modal (for Conceptual Timing gallery) -->
  <div id="clockModal" class="clock-modal fixed inset-0 z-50 bg-black/95 flex items-center justify-center p-6">
    <button onclick="closeClock()" class="absolute top-6 right-6 text-neutral-400 hover:text-white transition-colors"
      aria-label="Close">
      <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
    <div class="w-full max-w-5xl px-4">
      <div class="w-full h-[50vh] md:h-[60vh] mx-auto mb-8 overflow-hidden">
        <iframe id="modalIframe" src="" class="w-full h-full" title="Clock"></iframe>
      </div>
      <div class="text-center">
        <h3 id="modalTitle" class="text-2xl md:text-3xl text-white mb-4"></h3>
        <p id="modalDescription" class="text-neutral-400 text-lg max-w-2xl mx-auto"></p>
      </div>
    </div>
  </div>

  <script>
    // Year
    const yearEl = document.getElementById('year');
    if (yearEl) yearEl.textContent = String(new Date().getFullYear());

    // ==========================================
    // Gallery: Conceptual Timing modal + carousel
    // ==========================================
    const clockData = {
      'semi-linear': {
        src: 'meditativeclocks/clocks/semi-linear_clock/index.html',
        title: 'Semi-linear Clock',
        description: 'The seconds, minutes and hours progress randomly, though always to their usual total of 60 or 24. Every moment is unique, never repeating itself.'
      },
      'ebb-flow': {
        src: 'meditativeclocks/clocks/the_ebb_and_flow_of_time/index.html',
        title: 'The Ebb and Flow of Time',
        description: 'Probably the most minimalistic clock ever made. Time is represented by a single circle, which, at intervals of twelve hours, either expands or contracts.'
      },
      'past-present-future': {
        src: 'meditativeclocks/clocks/present_past_and_future/index.html',
        title: 'Present, Past and Future',
        description: 'Our subjective grasp of time is very different from the rigid, conventional representation. In our minds we wander between past, present and future freely.'
      },
      'hourglass': {
        src: 'meditativeclocks/clocks/abstract_hourglass/index.html',
        title: 'Abstract Hourglass',
        description: 'Time distilled to its essence. A conceptual hourglass where the present—the flowing sand—has disappeared altogether.'
      },
      'universe': {
        src: 'meditativeclocks/clocks/universe_clock/index.html',
        title: 'Universe Clock',
        description: 'The small triangle is time passed since the Big Bang. The large triangle is time left till the end of time. The scale is logarithmic—the next pixel will appear in 86 billion years.'
      },
      'serendipity': {
        src: 'meditativeclocks/clocks/serendipity/index.html',
        title: 'Serendipity on Demand',
        description: 'A special sound, twice or three times every 24 hours at random intervals. Connecting moments in your life that otherwise wouldn\'t have been connected.'
      }
    };

    function openClock(id) {
      const data = clockData[id];
      if (!data) return;

      const modal = document.getElementById('clockModal');
      const iframe = document.getElementById('modalIframe');
      const title = document.getElementById('modalTitle');
      const description = document.getElementById('modalDescription');
      if (!modal || !iframe || !title || !description) return;

      iframe.src = data.src;
      title.textContent = data.title;
      description.textContent = data.description;
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeClock() {
      const modal = document.getElementById('clockModal');
      const iframe = document.getElementById('modalIframe');
      if (!modal || !iframe) return;

      modal.classList.remove('active');
      iframe.src = '';
      document.body.style.overflow = '';
    }

    (function initClockModal() {
      const modal = document.getElementById('clockModal');
      if (!modal) return;

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeClock();
      });

      modal.addEventListener('click', (e) => {
        if (e.target && e.target.id === 'clockModal') closeClock();
      });
    })();

    (function initCarousel() {
      const track = document.getElementById('carouselTrack');
      if (!track) return;

      const items = track.querySelectorAll('.carousel-item');
      const dots = document.querySelectorAll('.carousel-dot');
      const prevBtn = document.getElementById('carouselPrev');
      const nextBtn = document.getElementById('carouselNext');
      let currentIndex = 0;

      function update() {
        track.style.transform = `translateX(-${currentIndex * 100}%)`;
        dots.forEach((dot, i) => dot.classList.toggle('active', i === currentIndex));
      }

      function goTo(index) {
        if (!items.length) return;
        if (index < 0) index = items.length - 1;
        if (index >= items.length) index = 0;
        currentIndex = index;
        update();
      }

      prevBtn?.addEventListener('click', () => goTo(currentIndex - 1));
      nextBtn?.addEventListener('click', () => goTo(currentIndex + 1));
      dots.forEach(dot => {
        dot.addEventListener('click', () => goTo(parseInt(dot.dataset.index)));
      });

      let startX = 0;
      track.addEventListener('touchstart', (e) => { startX = e.touches[0].clientX; }, { passive: true });
      track.addEventListener('touchend', (e) => {
        const diff = startX - e.changedTouches[0].clientX;
        if (Math.abs(diff) > 50) goTo(currentIndex + (diff > 0 ? 1 : -1));
      }, { passive: true });

      update();
    })();

    // ==========================================
    // STATE
    // ==========================================
    const state = {
      startTime: Date.now(),
      lastActivity: Date.now(),
      lastClickTime: null,
      clicks: 0,
      keysPressed: 0,
      touches: 0,
      lastKey: null,
      pointerX: 0,
      pointerY: 0,
      lastPointerX: 0,
      lastPointerY: 0,
      lastPointerTime: Date.now(),
      pointerVelocity: 0,
      lastScrollY: 0,
      scrollDir: null,
      frames: [],
      netRequests: 0,
      maxScrollY: 0,
      clipboardEvents: 0,
      selections: 0,
      lastSelection: '',
      domMutations: 0,
      elementsSeen: 0,
      resizeEvents: 0,
      longTasks: 0,
      cumulativeLayoutShift: 0,
      seenElements: new Set()
    };

    const sessionId = crypto.randomUUID?.() || Math.random().toString(36).substr(2, 15);

    // ==========================================
    // HELPER: Get element by ID, handling both mobile (m_) and desktop (d_) prefixes
    // ==========================================
    function getEl(id) {
      return {
        m: document.getElementById('m_' + id),
        d: document.getElementById('d_' + id)
      };
    }

    function setEl(id, value) {
      const els = getEl(id);
      if (els.m) els.m.textContent = value;
      if (els.d) els.d.textContent = value;
    }

    // ==========================================
    // STATIC DATA (set once)
    // ==========================================
    setEl('sessionId', sessionId.substring(0, 8));
    setEl('screen', `${screen.width}×${screen.height}`);
    setEl('pixelRatio', window.devicePixelRatio.toFixed(1) + 'x');
    setEl('cpuCores', navigator.hardwareConcurrency || '—');
    setEl('deviceMemory', navigator.deviceMemory ? navigator.deviceMemory + 'GB' : '—');
    setEl('platform', navigator.userAgentData?.platform || navigator.platform || '—');
    setEl('language', navigator.language);
    setEl('timezone', Intl.DateTimeFormat().resolvedOptions().timeZone);
    setEl('themePref', window.matchMedia('(prefers-color-scheme: dark)').matches ? 'DARK' : 'LIGHT');

    // Additional static data (now for both mobile and desktop)
    setEl('colorDepth', screen.colorDepth + 'bit');
    setEl('maxTouch', navigator.maxTouchPoints || 0);
    setEl('reduceMotion', window.matchMedia('(prefers-reduced-motion: reduce)').matches ? 'YES' : 'NO');
    setEl('historyLen', history.length);
    setEl('referrer', document.referrer || 'direct');

    // Storage estimate
    if (navigator.storage?.estimate) {
      navigator.storage.estimate().then(estimate => {
        const used = estimate.usage ? (estimate.usage / 1024 / 1024).toFixed(1) + 'MB' : '—';
        const quota = estimate.quota ? (estimate.quota / 1024 / 1024 / 1024).toFixed(1) + 'GB' : '—';
        setEl('storageUsed', used);
        setEl('storageQuota', quota);
      });
    }

    // ==========================================
    // TIMING & PAINT METRICS
    // ==========================================
    window.addEventListener('load', () => {
      setTimeout(() => {
        const nav = performance.getEntriesByType('navigation')[0];
        if (nav) {
          setEl('pageLoad', Math.round(nav.loadEventEnd) + 'ms');
          setEl('domReady', Math.round(nav.domContentLoadedEventEnd) + 'ms');
        }

        const paints = performance.getEntriesByType('paint');
        paints.forEach(entry => {
          if (entry.name === 'first-paint') {
            setEl('firstPaint', Math.round(entry.startTime) + 'ms');
          }
          if (entry.name === 'first-contentful-paint') {
            setEl('fcp', Math.round(entry.startTime) + 'ms');
          }
        });
      }, 0);
    });

    // LCP Observer
    if (window.PerformanceObserver) {
      try {
        const lcpObserver = new PerformanceObserver((list) => {
          const entries = list.getEntries();
          const lastEntry = entries[entries.length - 1];
          setEl('lcp', Math.round(lastEntry.startTime) + 'ms');
        });
        lcpObserver.observe({ type: 'largest-contentful-paint', buffered: true });
      } catch (e) { }

      try {
        const clsObserver = new PerformanceObserver((list) => {
          for (const entry of list.getEntries()) {
            if (!entry.hadRecentInput) {
              state.cumulativeLayoutShift += entry.value;
              setEl('cls', state.cumulativeLayoutShift.toFixed(3));
            }
          }
        });
        clsObserver.observe({ type: 'layout-shift', buffered: true });
      } catch (e) { }

      try {
        const longTaskObserver = new PerformanceObserver((list) => {
          state.longTasks += list.getEntries().length;
          setEl('longTasks', state.longTasks);
        });
        longTaskObserver.observe({ type: 'longtask' });
      } catch (e) { }
    }

    // JS Heap (Chrome only)
    function updateJsHeap() {
      if (performance.memory) {
        const heap = (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(1);
        setEl('jsHeap', heap + 'MB');
      }
    }
    updateJsHeap();

    // ==========================================
    // CONNECTION & ONLINE
    // ==========================================
    function updateConnection() {
      const conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
      setEl('connection', conn?.effectiveType?.toUpperCase() || '—');
      setEl('online', navigator.onLine ? 'YES' : 'NO');
      // One latency measure: RTT (ms), when exposed by the Network Information API (Chrome/Edge/Android mainly).
      setEl('rtt', typeof conn?.rtt === 'number' ? Math.round(conn.rtt) + 'ms' : '—');
    }
    updateConnection();
    window.addEventListener('online', updateConnection);
    window.addEventListener('offline', updateConnection);
    if (navigator.connection) {
      navigator.connection.addEventListener('change', updateConnection);
    }

    // ==========================================
    // TIME TO FIRSTS (scroll + interaction)
    // Measured from navigation start via performance.now()
    // ==========================================
    let firstScrollMs = null;
    let firstInteractionMs = null;

    function stampFirstScroll() {
      if (firstScrollMs !== null) return;
      firstScrollMs = Math.round(performance.now());
      setEl('ttfs', firstScrollMs + 'ms');
    }

    function stampFirstInteraction() {
      if (firstInteractionMs !== null) return;
      firstInteractionMs = Math.round(performance.now());
      setEl('ttfi', firstInteractionMs + 'ms');
    }

    // First interaction: pointer / key / touch (capture so we get it early)
    ['pointerdown', 'keydown', 'touchstart', 'mousedown'].forEach((type) => {
      window.addEventListener(type, stampFirstInteraction, { capture: true, once: true, passive: true });
    });

    // ==========================================
    // NETWORK REQUESTS
    // ==========================================
    if (window.PerformanceObserver) {
      try {
        const resourceObserver = new PerformanceObserver((list) => {
          state.netRequests += list.getEntries().length;
        });
        resourceObserver.observe({ type: 'resource', buffered: true });
      } catch (e) { }
      state.netRequests = performance.getEntriesByType('resource').length;
    }

    // ==========================================
    // POINTER
    // ==========================================
    function recordActivity() {
      state.lastActivity = Date.now();
    }

    function handlePointer(e) {
      const x = Math.round(e.clientX ?? e.touches?.[0]?.clientX ?? 0);
      const y = Math.round(e.clientY ?? e.touches?.[0]?.clientY ?? 0);

      const now = Date.now();
      const dt = (now - state.lastPointerTime) / 1000;
      if (dt > 0) {
        const dx = x - state.lastPointerX;
        const dy = y - state.lastPointerY;
        const dist = Math.sqrt(dx * dx + dy * dy);
        state.pointerVelocity = Math.round(dist / dt);
      }

      state.pointerX = x;
      state.pointerY = y;
      state.lastPointerX = x;
      state.lastPointerY = y;
      state.lastPointerTime = now;

      recordActivity();
    }
    document.addEventListener('mousemove', handlePointer);
    document.addEventListener('touchmove', handlePointer);

    // ==========================================
    // CLICKS
    // ==========================================
    document.addEventListener('click', () => {
      state.clicks++;
      state.lastClickTime = Date.now();
      recordActivity();
    });

    // ==========================================
    // KEYS
    // ==========================================
    document.addEventListener('keydown', (e) => {
      state.keysPressed++;
      state.lastKey = e.key.length === 1 ? e.key : `[${e.key}]`;
      recordActivity();
    });

    // ==========================================
    // TOUCH
    // ==========================================
    document.addEventListener('touchstart', () => {
      state.touches++;
      recordActivity();
    });

    // ==========================================
    // CLIPBOARD
    // ==========================================
    document.addEventListener('copy', () => { state.clipboardEvents++; recordActivity(); });
    document.addEventListener('paste', () => { state.clipboardEvents++; recordActivity(); });
    document.addEventListener('cut', () => { state.clipboardEvents++; recordActivity(); });

    // ==========================================
    // SELECTION
    // ==========================================
    document.addEventListener('selectionchange', () => {
      const selection = document.getSelection();
      const text = selection?.toString().trim();
      if (text && text !== state.lastSelection) {
        state.selections++;
        state.lastSelection = text.substring(0, 30) + (text.length > 30 ? '...' : '');
        recordActivity();
      }
    });

    // ==========================================
    // VIEWPORT
    // ==========================================
    function updateViewport() {
      setEl('viewport', `${window.innerWidth}×${window.innerHeight}`);
      setEl('orientation', window.innerWidth > window.innerHeight ? 'LAND' : 'PORT');
    }
    updateViewport();
    window.addEventListener('resize', () => {
      updateViewport();
      state.resizeEvents++;
    });

    // ==========================================
    // FULLSCREEN
    // ==========================================
    function updateFullscreen() {
      setEl('fullscreen', document.fullscreenElement ? 'YES' : 'NO');
    }
    document.addEventListener('fullscreenchange', updateFullscreen);

    // ==========================================
    // SCROLL
    // ==========================================
    function updateScroll() {
      stampFirstScroll();
      const y = Math.round(window.scrollY);
      const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
      const depth = maxScroll > 0 ? Math.round((y / maxScroll) * 100) : 0;

      if (y > state.lastScrollY) {
        state.scrollDir = '↓';
      } else if (y < state.lastScrollY) {
        state.scrollDir = '↑';
      }
      state.lastScrollY = y;

      if (y > state.maxScrollY) {
        state.maxScrollY = y;
      }

      setEl('scrollDepth', depth + '%');
      setEl('scrollY', y + 'px');
      setEl('scrollDir', state.scrollDir || '—');

      recordActivity();
    }
    document.addEventListener('scroll', updateScroll, { passive: true });

    // ==========================================
    // FOCUS & VISIBILITY
    // ==========================================
    function updateFocus() {
      setEl('tabFocus', document.hasFocus() ? 'YES' : 'NO');
    }
    function updateVisibility() {
      setEl('visibility', document.visibilityState === 'visible' ? 'YES' : 'NO');
    }
    updateFocus();
    updateVisibility();
    window.addEventListener('focus', updateFocus);
    window.addEventListener('blur', updateFocus);
    document.addEventListener('visibilitychange', updateVisibility);

    // ==========================================
    // PAGE LIFECYCLE
    // ==========================================
    function updatePageState(s) {
      setEl('pageState', s);
    }
    document.addEventListener('freeze', () => updatePageState('FROZEN'));
    document.addEventListener('resume', () => updatePageState('ACTIVE'));
    document.addEventListener('visibilitychange', () => {
      updatePageState(document.visibilityState === 'hidden' ? 'HIDDEN' : 'ACTIVE');
    });

    // ==========================================
    // MUTATION OBSERVER
    // ==========================================
    const mutationObserver = new MutationObserver((mutations) => {
      state.domMutations += mutations.length;
    });
    mutationObserver.observe(document.body, {
      childList: true, subtree: true, attributes: true, characterData: true
    });

    // ==========================================
    // INTERSECTION OBSERVER
    // ==========================================
    const intersectionObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting && !state.seenElements.has(entry.target)) {
          state.seenElements.add(entry.target);
          state.elementsSeen++;
        }
      });
    }, { threshold: 0.5 });

    document.querySelectorAll('section, h1, h2, p, footer').forEach(el => {
      intersectionObserver.observe(el);
    });

    // ==========================================
    // RESIZE OBSERVER
    // ==========================================
    const desktopHud = document.getElementById('desktopHud');
    const hudResizeObserver = new ResizeObserver(() => {
      state.resizeEvents++;
    });
    if (desktopHud) hudResizeObserver.observe(desktopHud);

    // ==========================================
    // FRAME RATE
    // ==========================================
    function measureFPS() {
      const now = performance.now();
      state.frames.push(now);
      while (state.frames.length > 0 && state.frames[0] < now - 1000) {
        state.frames.shift();
      }
      requestAnimationFrame(measureFPS);
    }
    requestAnimationFrame(measureFPS);

    // ==========================================
    // MAIN UPDATE LOOP
    // ==========================================
    function formatTime(ms) {
      const s = Math.floor(ms / 1000);
      const hrs = String(Math.floor(s / 3600)).padStart(2, '0');
      const mins = String(Math.floor((s % 3600) / 60)).padStart(2, '0');
      const secs = String(s % 60).padStart(2, '0');
      return `${hrs}:${mins}:${secs}`;
    }

    function update() {
      const now = Date.now();

      setEl('sessionTime', formatTime(now - state.startTime));
      setEl('localTime', new Date().toLocaleTimeString());

      const idle = Math.floor((now - state.lastActivity) / 1000);
      setEl('idleTime', idle + 's');

      setEl('pointerPos', `${state.pointerX}, ${state.pointerY}`);
      setEl('clicks', state.clicks);
      setEl('keysPressed', state.keysPressed);
      setEl('touches', state.touches);
      setEl('frameRate', state.frames.length);
      setEl('netRequests', state.netRequests);
      setEl('domMutations', state.domMutations);

      // Additional dynamic data (now for both mobile and desktop)
      setEl('pointerVelocity', state.pointerVelocity + ' px/s');
      setEl('lastKey', state.lastKey || '—');
      setEl('lastClickTime', state.lastClickTime ? Math.floor((now - state.lastClickTime) / 1000) + 's ago' : '—');
      setEl('clipboardEvents', state.clipboardEvents);
      setEl('selections', state.selections);
      setEl('elementsSeen', state.elementsSeen);
      setEl('resizeEvents', state.resizeEvents);
      setEl('lastSelection', state.lastSelection || '—');

      // Decay velocity
      if (now - state.lastPointerTime > 100) {
        state.pointerVelocity = Math.max(0, state.pointerVelocity - 50);
      }

      updateJsHeap();
      requestAnimationFrame(update);
    }
    requestAnimationFrame(update);

    // ==========================================
    // DESKTOP HUD TOGGLE
    // ==========================================
    const toggle = document.getElementById('hudToggle');
    let hudVisible = true;

    function positionToggle() {
      if (hudVisible && desktopHud) {
        const hudHeight = desktopHud.offsetHeight;
        toggle.style.top = (hudHeight + 8) + 'px';
      } else {
        toggle.style.top = '0.5rem';
      }
    }
    positionToggle();

    toggle.addEventListener('click', () => {
      hudVisible = !hudVisible;
      desktopHud.classList.toggle('collapsed', !hudVisible);
      toggle.textContent = hudVisible ? '[HIDE]' : '[SHOW]';
      positionToggle();
    });

    window.addEventListener('resize', positionToggle);
    if (desktopHud) new ResizeObserver(positionToggle).observe(desktopHud);

    // ==========================================
    // STICKY NAV: Show after reveal, hide on scroll up
    // ==========================================
    const stickyNav = document.getElementById('stickyNav');
    const worksSection = document.getElementById('works');
    const dissolveContainer = document.getElementById('dissolve-container');
    const revealSection = document.getElementById('reveal');
    let lastScrollTop = 0;
    let navCanShow = false;

    // Nav active state (Works selected by default)
    const navLinks = Array.from(document.querySelectorAll('#stickyNav [data-nav]'));
    function setActiveNav(id) {
      navLinks.forEach(a => a.classList.toggle('active', a.getAttribute('data-nav') === id));
    }
    setActiveNav('works');

    // Intersection observer to detect when the dissolve section is passed
    // (using #dissolve-container instead of #reveal since #reveal is pinned inside the sticky stage)
    const revealObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        // Nav can show when the dissolve container is NOT intersecting (we've scrolled past it)
        if (!entry.isIntersecting && entry.boundingClientRect.top < 0) {
          navCanShow = true;
        } else if (entry.isIntersecting) {
          // Still at or above dissolve
          navCanShow = false;
          stickyNav.classList.remove('visible');
          worksSection?.classList.remove('works-visible');
        }
      });
    }, { threshold: 0 });

    revealObserver.observe(dissolveContainer || revealSection);

    // Observe sections to update active link as you scroll (simple + robust)
    const sectionObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) setActiveNav(entry.target.id);
      });
    }, { threshold: 0.55 });
    ['works', 'about', 'contact'].forEach(id => {
      const el = document.getElementById(id);
      if (el) sectionObserver.observe(el);
    });

    // Reveal text scroll behavior - hide when scrolled past, show when scrolled back
    const revealText = document.getElementById('revealText');
    const revealTextTop = revealText.getBoundingClientRect().top + window.scrollY;
    const revealTextBottom = revealTextTop + revealText.offsetHeight;
    let lastRevealScrollTop = 0;

    window.addEventListener('scroll', () => {
      const scrollTop = window.scrollY;
      const viewportThird = window.innerHeight * 0.33;

      // During the dissolve stage, keep the reveal text visible.
      // The cross-dissolve already controls visibility via opacity, so hiding it here fights the effect.
      if (dissolveContainer) {
        const rect = dissolveContainer.getBoundingClientRect();
        const inDissolve = rect.bottom > 0 && rect.top < window.innerHeight;
        if (inDissolve) {
          revealText.classList.remove('hidden');
          lastRevealScrollTop = scrollTop;
          return;
        }
      }

      // Hide when the text has scrolled past the upper third of viewport
      if (scrollTop > revealTextBottom - viewportThird) {
        if (scrollTop > lastRevealScrollTop) {
          // Scrolling down - hide
          revealText.classList.add('hidden');
        } else {
          // Scrolling up - show
          revealText.classList.remove('hidden');
        }
      } else {
        // Text still in view - always show
        revealText.classList.remove('hidden');
      }

      lastRevealScrollTop = scrollTop;
    }, { passive: true });

    // Scroll handler for show/hide behavior
    window.addEventListener('scroll', () => {
      const scrollTop = window.scrollY;

      if (!navCanShow) {
        stickyNav.classList.remove('visible');
        lastScrollTop = scrollTop;
        return;
      }

      // Scrolling down: show nav
      if (scrollTop > lastScrollTop) {
        stickyNav.classList.add('visible');
        worksSection?.classList.add('works-visible');
      }
      // Scrolling up: hide nav
      else {
        stickyNav.classList.remove('visible');
      }

      lastScrollTop = scrollTop;
    }, { passive: true });

    // ==========================================
    // CROSS-DISSOLVE: Hero → Reveal (scroll-driven)
    // Pattern: tall container + sticky stage (simple, no deps)
    // ==========================================
    const heroHud = document.getElementById('heroHud');
    const reveal = document.getElementById('reveal');
    const heroLayer = document.getElementById('heroLayer');
    const revealLayer = document.getElementById('revealLayer');

    // ==========================================
    // HERO FIT: scale HUD so it always fits fully in the viewport height
    // (like zooming a camera out until the whole overlay is in frame)
    // ==========================================
    const heroContainer = heroHud?.querySelector('.hud-container');
    let lastHeroScale = 1;

    function fitHeroHud() {
      if (!heroHud || !heroContainer) return;

      const cs = getComputedStyle(heroHud);
      const padY = (parseFloat(cs.paddingTop) || 0) + (parseFloat(cs.paddingBottom) || 0);
      const availableH = heroHud.clientHeight - padY;
      if (availableH <= 0) return;

      // Estimate unscaled content height from current rect + last applied scale.
      const rectH = heroContainer.getBoundingClientRect().height || 0;
      const unscaledH = rectH / (lastHeroScale || 1);
      if (unscaledH <= 0) return;

      let scale = availableH / unscaledH;
      scale = Math.min(1, Math.max(0.55, scale));
      if (Math.abs(scale - lastHeroScale) < 0.01) return;
      lastHeroScale = scale;

      // Prefer zoom (affects layout), fallback to transform if unsupported.
      const supportsZoom = typeof CSS !== 'undefined' && typeof CSS.supports === 'function' && CSS.supports('zoom', '1');
      if (supportsZoom) {
        heroContainer.style.zoom = String(scale);
        heroContainer.style.transform = '';
        heroContainer.style.width = '';
      } else {
        heroContainer.style.zoom = '';
        heroContainer.style.transformOrigin = 'top center';
        heroContainer.style.transform = `scale(${scale})`;
        heroContainer.style.width = `${100 / scale}%`;
      }
    }

    function scheduleFitHeroHud() {
      requestAnimationFrame(() => requestAnimationFrame(fitHeroHud));
    }

    window.addEventListener('resize', scheduleFitHeroHud);
    if (window.visualViewport) window.visualViewport.addEventListener('resize', scheduleFitHeroHud);
    document.fonts?.ready?.then(scheduleFitHeroHud);
    if (window.ResizeObserver && heroContainer) new ResizeObserver(scheduleFitHeroHud).observe(heroContainer);
    scheduleFitHeroHud();

    let dissolveDistance = window.innerHeight; // fade distance in px (~first 100vh)
    let dissolveViewportH = window.innerHeight;

    function getViewportH() {
      // Mobile browsers change `innerHeight` as the URL bar collapses; visualViewport is more stable.
      return window.visualViewport?.height || window.innerHeight;
    }

    function updateDissolveMetrics() {
      dissolveViewportH = getViewportH();
      dissolveDistance = dissolveViewportH;

      // Ensure we always have enough scroll room, even if CSS `vh` is weird on mobile.
      // 3x viewport: 1x fade + 1x hold + 1x buffer before next section feels natural.
      if (dissolveContainer) {
        dissolveContainer.style.height = Math.round(dissolveViewportH * 3) + 'px';
      }
    }

    function getDissolveProgress() {
      const rect = dissolveContainer.getBoundingClientRect();
      const totalScrollable = Math.max(1, dissolveContainer.offsetHeight - dissolveViewportH);
      const scrolled = Math.min(Math.max(-rect.top, 0), totalScrollable);
      return Math.min(1, scrolled / dissolveDistance);
    }

    function handleDissolve() {
      const progress = getDissolveProgress();

      // Cross-fade: hero fades out, reveal fades in
      heroLayer.style.opacity = String(1 - progress);
      revealLayer.style.opacity = String(progress);

      if (progress >= 1) {
        revealLayer.classList.add('active');
      } else {
        revealLayer.classList.remove('active');
      }
    }

    function onDissolveResize() {
      updateDissolveMetrics();
      handleDissolve();
    }

    window.addEventListener('resize', onDissolveResize);
    if (window.visualViewport) {
      window.visualViewport.addEventListener('resize', onDissolveResize);
    }
    window.addEventListener('scroll', handleDissolve, { passive: true });
    updateDissolveMetrics();
    handleDissolve(); // Initial state
  </script>
</body>

</html>